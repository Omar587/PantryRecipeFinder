@model IEnumerable<RecipeFinder.Models.Recipe>
@using RecipeFinder.Models.Enums

@{
    ViewData["Title"] = "Recipes";
}

<style>
    @@import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&family=Playfair+Display:wght@700&display=swap');
    
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }
    
    body {
        font-family: 'Outfit', sans-serif;
        background: linear-gradient(135deg, #fef6e4 0%, #ffe8cc 100%);
        min-height: 100vh;
    }
    
    .container-wrapper {
        display: flex;
        gap: 2rem;
        max-width: 1600px;
        margin: 0 auto;
        padding: 2rem;
    }
    
    /* Filter Sidebar */
    .filter-sidebar {
        width: 320px;
        min-width: 320px;
        flex-shrink: 0;
        background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
        border-radius: 24px;
        padding: 2rem;
        box-shadow: 0 20px 60px rgba(255, 107, 53, 0.3);
        align-self: flex-start;
        position: sticky;
        top: 2rem;
    }
    
    .filter-sidebar::-webkit-scrollbar {
        width: 8px;
    }
    
    .filter-sidebar::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
    }
    
    .filter-sidebar::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.3);
        border-radius: 10px;
    }
    
    .filter-sidebar h2 {
        font-family: 'Playfair Display', serif;
        color: white;
        font-size: 2rem;
        margin-bottom: 1.5rem;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    .filter-group {
        margin-bottom: 1.5rem;
    }
    
    .filter-group label {
        display: block;
        color: white;
        font-weight: 600;
        margin-bottom: 0.5rem;
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .filter-group select,
    .filter-group input {
        width: 100%;
        padding: 0.75rem 1rem;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 12px;
        background: rgba(255, 255, 255, 0.95);
        color: #333;
        font-size: 1rem;
        font-family: 'Outfit', sans-serif;
        transition: all 0.3s ease;
        cursor: pointer;
    }
    
    .filter-group select:focus,
    .filter-group input:focus {
        outline: none;
        border-color: white;
        background: white;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        transform: translateY(-2px);
    }
    
    .filter-group input[type="range"] {
        cursor: pointer;
        height: 8px;
        border-radius: 5px;
        background: rgba(255, 255, 255, 0.3);
        -webkit-appearance: none;
    }
    
    .filter-group input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: white;
        cursor: pointer;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        transition: all 0.2s ease;
    }
    
    .filter-group input[type="range"]::-webkit-slider-thumb:hover {
        transform: scale(1.2);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }
    
    .rating-display {
        color: white;
        font-size: 1.5rem;
        font-weight: 700;
        text-align: center;
        margin-top: 0.5rem;
    }
    
    .filter-buttons {
        display: flex;
        gap: 0.75rem;
        margin-top: 2rem;
    }
    
    .btn-apply,
    .btn-reset {
        flex: 1;
        padding: 0.875rem;
        border: none;
        border-radius: 12px;
        font-weight: 600;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        font-family: 'Outfit', sans-serif;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .btn-apply {
        background: white;
        color: #ff6b35;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    .btn-apply:hover {
        background: #fff5f0;
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
    }
    
    .btn-reset {
        background: rgba(255, 255, 255, 0.2);
        color: white;
        border: 2px solid white;
    }
    
    .btn-reset:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: translateY(-2px);
    }
    
    /* Main Content */
    .main-content {
        flex: 1;
    }
    
    h1 {
        font-family: 'Playfair Display', serif;
        font-size: 3rem;
        color: #ff6b35;
        margin-bottom: 2rem;
        text-align: center;
    }
    
    .recipe-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 2rem;
        margin-bottom: 3rem;
    }
    
    .recipe-card {
        background: white;
        border-radius: 20px;
        overflow: hidden;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .recipe-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 20px 50px rgba(255, 107, 53, 0.2);
    }
    
    .recipe-card img {
        width: 100%;
        height: 200px;
        object-fit: cover;
        transition: transform 0.4s ease;
    }
    
    .recipe-card:hover img {
        transform: scale(1.05);
    }
    
    .recipe-card h3 {
        font-family: 'Playfair Display', serif;
        font-size: 1.5rem;
        color: #2d3436;
        padding: 1.5rem 1.5rem 0.5rem;
        line-height: 1.3;
    }
    
    .recipe-card p {
        padding: 0 1.5rem 1rem;
        color: #636e72;
        line-height: 1.8;
    }
    
    .recipe-card a {
        display: inline-block;
        margin: 0 1.5rem 1.5rem;
        padding: 0.75rem 1.5rem;
        background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
        color: white;
        text-decoration: none;
        border-radius: 10px;
        font-weight: 600;
        transition: all 0.3s ease;
    }
    
    .recipe-card a:hover {
        transform: translateX(5px);
        box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
    }
    
    /* Pagination */
    .pagination {
        display: flex;
        justify-content: center;
        gap: 0.5rem;
        padding: 2rem 0;
    }
    
    .page-item {
        list-style: none;
    }
    
    .page-link {
        display: block;
        padding: 0.75rem 1.25rem;
        background: white;
        color: #ff6b35;
        text-decoration: none;
        border-radius: 12px;
        font-weight: 600;
        transition: all 0.3s ease;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }
    
    .page-link:hover {
        background: #ff6b35;
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
    }
    
    .page-item.active .page-link {
        background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
        color: white;
    }
    
    /* Select2-like searchable dropdown styling */
    .select-wrapper {
        position: relative;
    }
    
    .select-wrapper select {
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
        padding-right: 2.5rem;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23333' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 0.75rem center;
        background-size: 1.25rem;
    }

    @@media (max-width: 1200px) {
        .container-wrapper {
            flex-direction: column;
        }
        
        .filter-sidebar {
            width: 100%;
            position: relative;
            top: 0;
        }
        
        .recipe-grid {
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        }
    }
</style>

<div class="container-wrapper">
    <!-- Filter Sidebar -->
    <aside class="filter-sidebar">
        <h2>Filter Recipes</h2>
        <form id="filterForm" method="get" asp-action="Index">
            <div class="filter-group">
                <label for="cuisine">Cuisine</label>
                <div class="select-wrapper">
                    <select id="cuisine" name="cuisine">
                        <option value="">All Cuisines</option>
                        @foreach (var cuisine in Enum.GetValues(typeof(Cuisine)))
                        {
                            <option value="@cuisine" selected="@(ViewBag.SelectedCuisine == cuisine.ToString())">
                                @cuisine
                            </option>
                        }
                    </select>
                </div>
            </div>

            <div class="filter-group">
                <label for="difficulty">Difficulty</label>
                <div class="select-wrapper">
                    <select id="difficulty" name="difficulty">
                        <option value="">All Difficulties</option>
                        @foreach (var difficulty in Enum.GetValues(typeof(Difficulty)))
                        {
                            <option value="@difficulty" selected="@(ViewBag.SelectedDifficulty == difficulty.ToString())">
                                @difficulty
                            </option>
                        }
                    </select>
                </div>
            </div>

            <div class="filter-group">
                <label for="minRating">Minimum Rating</label>
                <input type="range" id="minRating" name="minRating" min="0" max="5" step="0.5" 
                       value="@(ViewBag.SelectedMinRating ?? 0)" />
                <div class="rating-display">
                    <span id="ratingValue">@(ViewBag.SelectedMinRating ?? 0)</span> ⭐
                </div>
            </div>

            <div class="filter-group">
                <label for="cookTime">Cook Time</label>
                <div class="select-wrapper">
                    <select id="cookTime" name="cookTime">
                        <option value="">Any Duration</option>
                        <option value="<30" selected="@(ViewBag.SelectedCookTime == "<30")">Under 30 min</option>
                        <option value="30-60" selected="@(ViewBag.SelectedCookTime == "30-60")">30-60 min</option>
                        <option value=">60" selected="@(ViewBag.SelectedCookTime == ">60")">Over 60 min</option>
                    </select>
                </div>
            </div>

            <div class="filter-group">
                <label for="dietary">Dietary Options</label>
                <div class="select-wrapper">
                    <select id="dietary" name="dietary">
                        <option value="">All Options</option>
                        <option value="Vegetarian" selected="@(ViewBag.SelectedDietary == "Vegetarian")">Vegetarian</option>
                        <option value="Vegan" selected="@(ViewBag.SelectedDietary == "Vegan")">Vegan</option>
                        <option value="GlutenFree" selected="@(ViewBag.SelectedDietary == "GlutenFree")">Gluten Free</option>
                        <option value="DairyFree" selected="@(ViewBag.SelectedDietary == "DairyFree")">Dairy Free</option>
                    </select>
                </div>
            </div>

            <input type="hidden" name="p" value="1" />

            <div class="filter-buttons">
                <button type="submit" class="btn-apply">Apply</button>
                <button type="button" class="btn-reset" onclick="resetFilters()">Reset</button>
            </div>
        </form>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <h1>Discover Recipes</h1>

        <div class="recipe-grid">
            @foreach (var recipe in Model)
            {
                <div class="recipe-card">
                    <img src="@recipe.ImageUrl" alt="@recipe.Name" />
                    <h3>@recipe.Name</h3>
                    <p>
                        <strong>Cuisine:</strong> @recipe.Cuisine <br />
                        <strong>Difficulty:</strong> @recipe.Difficulty <br />
                        <strong>Total Time:</strong> @recipe.TotalTime() min
                    </p>
                    <a asp-action="Details" asp-route-id="@recipe.Id">View Details →</a>
                </div>
            }
        </div>

        <nav aria-label="Page navigation">
            <ul class="pagination">
                @if (ViewBag.TotalPages != null)
                {
                    int totalPages = ViewBag.TotalPages;
                    int currentPage = ViewBag.CurrentPage ?? 1;

                    @for (int i = 1; i <= totalPages; i++)
                    {
                        <li class="page-item @(i == currentPage ? "active" : "")">
                            <a class="page-link" href="?page=@i&cuisine=@ViewBag.SelectedCuisine&difficulty=@ViewBag.SelectedDifficulty&minRating=@ViewBag.SelectedMinRating&cookTime=@ViewBag.SelectedCookTime&dietary=@ViewBag.SelectedDietary">@i</a>
                        </li>
                    }
                }
            </ul>
        </nav>
    </main>
</div>

<script>
    // Update rating display
    const ratingSlider = document.getElementById('minRating');
    const ratingValue = document.getElementById('ratingValue');
    
    ratingSlider.addEventListener('input', function() {
        ratingValue.textContent = this.value;
    });
    
    // Reset filters function
    function resetFilters() {
        window.location.href = '@Url.Action("Index", "Recipe")';
    }
    
    // Add search functionality to selects with many options
    const cuisineSelect = document.getElementById('cuisine');
    const originalCuisineOptions = Array.from(cuisineSelect.options);
    
    // Make cuisine searchable (since it has many options)
    cuisineSelect.addEventListener('focus', function() {
        this.size = Math.min(10, this.options.length);
    });
    
    cuisineSelect.addEventListener('blur', function() {
        setTimeout(() => {
            this.size = 1;
        }, 200);
    });
    
    cuisineSelect.addEventListener('keyup', function(e) {
        if (e.key === 'Enter') {
            this.size = 1;
            this.blur();
            return;
        }
        
        const searchTerm = this.value.toLowerCase();
        
        // Clear current options
        while (this.options.length > 0) {
            this.remove(0);
        }
        
        // Add "All Cuisines" option
        const allOption = document.createElement('option');
        allOption.value = '';
        allOption.text = 'All Cuisines';
        this.add(allOption);
        
        // Filter and add matching options
        originalCuisineOptions.forEach(opt => {
            if (opt.value === '' || opt.text.toLowerCase().includes(searchTerm)) {
                this.add(opt.cloneNode(true));
            }
        });
        
        this.size = Math.min(10, this.options.length);
    });
    
    // Restore filtered selection on change
    cuisineSelect.addEventListener('change', function() {
        this.size = 1;
        this.blur();
    });
</script>